<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no, orientation=portrait" />
  <title>AR 체험 - 태극나비</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="./css/style.css">
</head>
<body>
  <!-- 스플래시 화면 -->
  <div id="splash-screen">
    <img src="./assets/popup.png" alt="AR Photo 시작" class="splash-image">
  </div>
  
  <!-- 배경음악 -->
  <audio id="background-music" preload="auto" loop>
    <source src="./assets/back.mp3" type="audio/mpeg">
    Your browser does not support the audio element.
  </audio>
  
  <!-- 캐릭터 등장 효과음 -->
  <audio id="character-appear-sound" preload="auto">
    <source src="./assets/open.mp3" type="audio/mpeg">
    Your browser does not support the audio element.
  </audio>
  
  <div id="camera-container">
    <video id="video" autoplay muted playsinline></video>
    <canvas id="canvas" style="display: none;"></canvas>
    
    <!-- intro-text 제거 (말풍선 이미지를 사용하므로 불필요) -->
    
    <!-- 카메라 화면 말풍선 (이미지) -->
    <div id="camera-speech-bubble" class="speech-bubble camera-speech">
      <img id="camera-speech-image" class="speech-image" alt="카메라 말풍선" />
    </div>
    
    <!-- 빛줄기 효과 -->
    <div id="light-beam">
      <img src="./assets/characters/light.png" alt="빛줄기" />
    </div>
    
    <!-- 4번 캐릭터 전용 바닥 이미지 (고정) -->
    <div id="character-ground" class="character-ground" style="display: none;">
      <img src="./assets/characters/c4_ground.png" alt="바닥" />
    </div>
    
    <div id="character" data-photo-guidance="무봉사에는 전통 속 태극 문양이 깃들어 있어. 무안의 고즈넉한 길을 걷다 보면 다시 만날 수 있을지도 몰라.">
      <img src="./assets/characters/c3.png" alt="태극나비" onerror="this.src='./assets/characters/c3.png'" />
    </div>

    <div id="character-guide" aria-hidden="true">
      <img src="./assets/guide.png" alt="캐릭터 조작 가이드" />
    </div>

    <div id="controls">
        <button class="btn btn-primary" id="capture-btn">
          <img src="./assets/characters/camera2.png" alt="사진 찍기" class="camera-icon">
        </button>
      <button class="btn" id="retake-btn" style="display: none;">🔄 다시 찍기</button>
    </div>
    
    <div id="loading">
      <div class="spinner"></div>
      <p>카메라를 준비하고 있습니다...</p>
    </div>
    
    <div id="permission-request">
      <h3>카메라 권한이 필요합니다</h3>
      <p>AR 체험을 위해 카메라 접근 권한을 허용해주세요.</p>
      <div class="permission-instructions">
        <h4>아이폰 사용자를 위한 안내:</h4>
        <ol>
          <li>화면 상단의 카메라 아이콘을 터치하세요</li>
          <li>"허용"을 선택하세요</li>
          <li>페이지를 새로고침하세요</li>
        </ol>
        <p><strong>참고:</strong> HTTPS 연결이 필요합니다.</p>
      </div>
      <button class="btn btn-primary" id="request-permission">권한 허용</button>
    </div>
  </div>
  
  <div id="photo-result">
    <img id="captured-photo" alt="촬영된 사진" />
    
    <!-- 말풍선 정보 (이미지) -->
    <div id="speech-bubble" class="speech-bubble">
      <img id="result-speech-image" class="speech-image" alt="촬영 후 말풍선" />
    </div>
    
    <!-- 하단 액션 버튼 -->
    <div id="photo-actions">
      <button class="action-btn retake-btn" id="retake-btn">
        <img src="./assets/reTake.png" alt="다시 찍기" class="action-icon">
      </button>
      <button class="action-btn save-btn" id="save-btn">
        <img src="./assets/save.png" alt="저장하기" class="action-icon">
      </button>
    </div>
  </div>
  
  <!-- 화면 방향 경고 (가로 모드) -->
  <div id="orientation-warning">
    <div id="orientation-warning-icon">📱</div>
    <h2>세로 모드로 사용해주세요</h2>
    <p>이 AR 체험은 세로 모드에서만 제공됩니다.<br>기기를 세로로 회전해주세요.</p>
  </div>

  <script>
    // 캐릭터 데이터를 JavaScript로 전달
    window.characterData = {
      id: 3,
      name: '태극나비',
      image: './assets/characters/c3.png',
      greeting: {
        title: '나는 태극의 기운을 품은 나비야.',
        message: '시간과 공간을 넘어, 이 여정의 끝에서 너를 기다렸지. 너의 빛을 내 날개에 담아 함께 사진을 남겨보자.'
      },
      photoGuidance: '무봉사에는 전통 속 태극 문양이 깃들어 있어. 무안의 고즈넉한 길을 걷다 보면 다시 만날 수 있을지도 몰라.',
      location: '무봉사/무안 고즈넉한 길'
    };
  </script>
  <script src="./js/webar.js"></script>
</body>
</html>
